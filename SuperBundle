--[[ 
	DEBUG CUSTOM ANIMATION SCRIPT
	Author: You
	Location: StarterCharacterScripts
]]

print("[ANIM DEBUG] Script started")

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
print("[ANIM DEBUG] Player:", player.Name)

local character = script.Parent
print("[ANIM DEBUG] Character loaded:", character.Name)

local humanoid = character:WaitForChild("Humanoid", 5)
if not humanoid then
	warn("[ANIM DEBUG] Humanoid not found")
	return
end
print("[ANIM DEBUG] Humanoid found")

local animator = humanoid:WaitForChild("Animator", 5)
if not animator then
	warn("[ANIM DEBUG] Animator not found")
	return
end
print("[ANIM DEBUG] Animator found")

-- Disable default Roblox animations
local animate = character:FindFirstChild("Animate")
if animate then
	animate.Disabled = true
	print("[ANIM DEBUG] Default Animate script disabled")
else
	warn("[ANIM DEBUG] Animate script NOT found")
end

-- Animation IDs
local IDLE_ID = "rbxassetid://121357243986533"
local WALK_ID = "rbxassetid://93206157668596"

-- Create animations
local idleAnim = Instance.new("Animation")
idleAnim.AnimationId = IDLE_ID

local walkAnim = Instance.new("Animation")
walkAnim.AnimationId = WALK_ID

print("[ANIM DEBUG] Animation instances created")

-- Load tracks (protected)
local successIdle, idleTrack = pcall(function()
	return animator:LoadAnimation(idleAnim)
end)

if not successIdle then
	warn("[ANIM DEBUG] Failed to load IDLE animation")
	return
end

local successWalk, walkTrack = pcall(function()
	return animator:LoadAnimation(walkAnim)
end)

if not successWalk then
	warn("[ANIM DEBUG] Failed to load WALK animation")
	return
end

print("[ANIM DEBUG] Animation tracks loaded")

idleTrack.Priority = Enum.AnimationPriority.Movement
walkTrack.Priority = Enum.AnimationPriority.Movement

idleTrack.Looped = true
walkTrack.Looped = true

-- Utility
local function stopAll(reason)
	if idleTrack.IsPlaying then
		idleTrack:Stop()
		print("[ANIM DEBUG] Idle stopped:", reason)
	end
	if walkTrack.IsPlaying then
		walkTrack:Stop()
		print("[ANIM DEBUG] Walk stopped:", reason)
	end
end

-- State changes
humanoid.StateChanged:Connect(function(old, new)
	print("[ANIM DEBUG] State changed:", old.Name, "â†’", new.Name)

	if new == Enum.HumanoidStateType.Jumping
	or new == Enum.HumanoidStateType.Freefall
	or new == Enum.HumanoidStateType.Climbing
	or new == Enum.HumanoidStateType.Swimming
	or new == Enum.HumanoidStateType.Seated
	or new == Enum.HumanoidStateType.Dead then
		stopAll("state change")
	end
end)

-- Movement handler
RunService.RenderStepped:Connect(function()
	if humanoid.Health <= 0 then return end

	local state = humanoid:GetState()
	local moving = humanoid.MoveDirection.Magnitude > 0

	-- Ground-only logic
	if state == Enum.HumanoidStateType.Running or state == Enum.HumanoidStateType.RunningNoPhysics then
		if moving then
			if not walkTrack.IsPlaying then
				stopAll("switch to walk")
				walkTrack:Play()
				print("[ANIM DEBUG] Walk animation PLAYING")
			end
		else
			if not idleTrack.IsPlaying then
				stopAll("switch to idle")
				idleTrack:Play()
				print("[ANIM DEBUG] Idle animation PLAYING")
			end
		end
	else
		stopAll("not ground state")
	end
end)

print("[ANIM DEBUG] Animation controller fully initialized")
